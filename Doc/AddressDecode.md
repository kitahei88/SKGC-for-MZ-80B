# アドレスデコードについて

MZ-2000はZ80A-PIOのPORT A7(DISP)とA6(C/_G)でGRAMやCGRAMをアクセスするようにバンク切り換えを行います。

これらの信号はIC16 LZ90D02に入力され、アクセス中のアドレスによって、_GSELや_CSELをアサートし、アクセスするRAMの切り換えを行っています。

MZ-80Bでも同様にZ80A-PIOのPORT A7(DSP)とA6(DSPAD）によってバンク切り換えを行っています。
MZ-80Bではこれらの信号はIC2 G#1に入力され、アクセス中のアドレスによって_CSEDと＿CSDDを出力することで、アクセスするRAMを切り換えています。

ですので、MZ-2000で_GSELをアサートする場合は_CSEDがアサートされ、_CSELの場合は_CSDDがアサートされるようにアドレス変換してあげればよいです。

MZ-80Bモードの場合はDSPやDSPADなどはスルーしてG#1に入力します。
MZ-2000モードでは、DISPとC/_Gの組み合わせでGRAMのアクセス且つ0xC000から0xFFFFまでのアクセス(A15,A14が1)の場合はMZ-80BでのRAMブロックIIで0xE000から0xFFFFまでをアクセスしているように出力して_CSEDを出力させます。
同様にCGRAMの場合はRAMブロックIIで0xD000から0xDFFFまでをアクセスしているように変換し、_CSDDを出力させます。

このようにアドレスデコードすることで、MZ-2000のモードをMZ-80Bで生成しています。
